<h2>癒し方法診断</h2>

<%= form_with model: @diagnosis_record, url: diagnoses_path, local: true, data: { turbo: false } do |f| %>
  <% @questions.each_with_index do |question, index| %>
    <div class="question-block">
      <p><strong><%= question.question_content %></strong></p>

      <% answer = @diagnosis_record.try(:diagnosis_answers).try(:[], index) || DiagnosisAnswer.new %>
      <%= f.fields_for :diagnosis_answers, answer, child_index: index do |a| %>
        <%= a.hidden_field :question_id, value: question.id %>

        <% question.choices.each do |choice| %>
          <label>
            <%= a.radio_button :choice_id, choice.id %>
            <%= choice.choice_content %>
          </label><br>
        <% end %>
      <% end %>
    </div>
    <hr>
  <% end %>

  <%= f.submit "診断結果を表示", class: "btn btn-primary" %>
<% end %>
